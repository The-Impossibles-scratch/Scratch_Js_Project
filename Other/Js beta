javascript:!function(){const e=window.fetch,t=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.send,o=XMLHttpRequest.prototype.setRequestHeader,a=[],r=(e,t,n,o,a,r,s,c)=>{a.push({type:e,method:t,url:n,requestBody:o,requestHeaders:a,status:r,responseHeaders:s,responseBody:c,timestamp:(new Date).toISOString()})},s=e=>{const t={};return e&&"function"==typeof e.forEach?e.forEach(((e,n)=>{t[n]=e})):e&&"object"==typeof e&&Object.keys(e).forEach((n=>{t[n]=e[n]})),t};window.fetch=async(...n)=>{const o=n[0],a=n[1]||{};if("string"==typeof o&&o.includes("api.scratch.mit.edu")){const c=(a.method||"GET").toUpperCase(),i=a.body||null,l=s(a.headers),p=await e(...n),u=p.clone(),f=await u.text(),d=s(u.headers);return r("fetch",c,o,i,l,p.status,d,f),p}return e(...n)},XMLHttpRequest.prototype.open=function(e,t,...n){return this._isScratchAPI="string"==typeof t&&t.includes("api.scratch.mit.edu"),this._url=t,this._method=e,this._requestHeaders={},o.call(this,e,t,...n)},XMLHttpRequest.prototype.setRequestHeader=function(e,t){return this._requestHeaders||(this._requestHeaders={}),this._requestHeaders[e]=t,o.call(this,e,t)},XMLHttpRequest.prototype.send=function(e){return this._body=e,this._isScratchAPI&&this.addEventListener("load",(()=>{const t=this.getAllResponseHeaders().split("\r\n").filter((e=>e.trim())).reduce(((e,t)=>{const[n,o]=t.split(": ");return e[n.toLowerCase()]=o,e}),{});r("xhr",this._method,this._url,this._body,this._requestHeaders,this.status,t,this.responseText)})),n.call(this,e)},window.addEventListener("beforeunload",()=>{if(a.length){const e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="scratch-api-log-"+(new Date).toISOString().replace(/[:.]/g,"-")+".json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}}),alert("✅ Scratch API Logger 有効化済み\nページ終了時に自動でログ保存します。")}();